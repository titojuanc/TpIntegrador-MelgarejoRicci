<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Agregar nueva publicación</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:#f5f7fb;
      margin:0;
      padding:20px;
      color:#111;
    }
    h1 {
      text-align:center;
      font-size:26px;
      margin-bottom:24px;
    }
    .card {
      max-width:600px;
      margin:30px auto;
      background:#fff;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(15,23,42,0.08);
      padding:24px;
    }
    label {
      display:block;
      margin-bottom:6px;
      font-weight:600;
      color:#333;
    }
    input, textarea, select {
      width:100%;
      padding:10px;
      border:1px solid #ccc;
      border-radius:8px;
      font-size:14px;
      margin-bottom:16px;
      resize:vertical;
    }
    button {
      background:#0b62d0;
      color:#fff;
      border:none;
      padding:10px 18px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      font-size:15px;
    }
    button:hover {
      background:#094fa7;
    }
    .msg {
      text-align:center;
      margin-top:20px;
      font-weight:600;
    }
    .success { color:#0b8a3e; }
    .error { color:#d03030; }
    .oculto { display: none; }
  </style>
</head>
<body>
  <h1>Agregar nueva publicación</h1>

  <div class="card">
    <form id="formPublicacion">
      <label for="nombre">Nombre del producto o servicio</label>
      <input type="text" id="nombre" name="nombre" placeholder="Ej: Brochas de papel" required>

      <label for="descripcion">Descripción</label>
      <textarea id="descripcion" name="descripcion" rows="3" placeholder="Describe tu publicación..." required></textarea>

      <label for="precio">Precio</label>
      <input type="number" id="precio" name="precio" step="0.01" placeholder="Ej: 50.00" required>

      <label for="stock">Stock inicial</label>
      <input type="number" id="stock" name="stock" placeholder="Ej: 50" required>

      <label for="id_usuario">ID de usuario</label>
      <input type="number" id="id_usuario" name="id_usuario" placeholder="Ej: 1" required>

      <label for="estado">Estado</label>
      <select id="estado" name="estado" required>
        <option value="">Seleccionar estado</option>
        <option value="Activo">Activo</option>
        <option value="En pausa">En pausa</option>
        <option value="Inactivo">Inactivo</option>
      </select>

      <label for="contenido">Tipo de contenido</label>
      <select id="contenido" name="contenido" required>
        <option value="">Seleccione una opción</option>
        <option value="Producto">Producto</option>
        <option value="Servicio">Servicio</option>
      </select>

      <!-- Campo para Producto -->
      <div id="campoGarantia" class="oculto">
        <label for="garantia">Días de garantía</label>
        <input type="number" id="garantia" name="garantia" min="0" placeholder="Ej: 30">
      </div>

      <!-- Campo para Servicio -->
        <div id="campoFecha" class="oculto">
            <label>Días de servicio</label>
            <div id="diasCheckboxes" style="display:flex; flex-wrap:wrap; gap:10px;">
                <label><input type="checkbox" name="diasCanje" value="1"> Lunes</label>
                <label><input type="checkbox" name="diasCanje" value="2"> Martes</label>
                <label><input type="checkbox" name="diasCanje" value="3"> Miércoles</label>
                <label><input type="checkbox" name="diasCanje" value="4"> Jueves</label>
                <label><input type="checkbox" name="diasCanje" value="5"> Viernes</label>
                <label><input type="checkbox" name="diasCanje" value="6"> Sábado</label>
                <label><input type="checkbox" name="diasCanje" value="7"> Domingo</label>
            </div>
        </div>



      <div style="text-align:center;margin-top:20px;">
        <button type="submit">Guardar publicación</button>
      </div>
    </form>

    <div id="mensaje" class="msg"></div>
  </div>

  <script>
    const contenidoSelect = document.getElementById('contenido');
    const campoGarantia = document.getElementById('campoGarantia');
    const campoFecha = document.getElementById('campoFecha');

    // Mostrar/ocultar campos según la selección
    contenidoSelect.addEventListener('change', function() {
      if (this.value === 'Producto') {
        campoGarantia.classList.remove('oculto');
        campoFecha.classList.add('oculto');
      } else if (this.value === 'Servicio') {
        campoFecha.classList.remove('oculto');
        campoGarantia.classList.add('oculto');
      } else {
        campoGarantia.classList.add('oculto');
        campoFecha.classList.add('oculto');
      }
    });

    // Envío del formulario
    document.getElementById("formPublicacion").addEventListener("submit", function(event) {
        event.preventDefault();

        // Crear un objeto con los datos del formulario
        const tipo = document.getElementById("contenido").value;
        const formData = {
            nombre: document.getElementById("nombre").value,
            descripcion: document.getElementById("descripcion").value,
            precio: parseFloat(document.getElementById("precio").value),
            fechaPublicacion: new Date(),
            stock: parseInt(document.getElementById("stock").value),
            id_usuario: parseInt(document.getElementById("id_usuario").value),
            estado: document.getElementById("estado").value,
            tipo: tipo,
            garantia: parseInt(document.getElementById("garantia").value),
            dias: Array.from(document.querySelectorAll('input[name="diasCanje"]:checked')).map(chk => parseInt(chk.value))
        };

    

        console.log("Datos a enviar:", formData);
        
        
        fetch("http://localhost:8080/POST/api/usuarios/1/publicaciones", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            console.log("Publicación creada:", data);
            document.getElementById("mensaje").innerHTML = 
              '<span class="success">✅ Publicación creada con éxito</span>';
            document.getElementById("formPublicacion").reset();
            campoGarantia.classList.add('oculto');
            campoFecha.classList.add('oculto');
        })
        .catch(error => {
            console.error("Error al crear la publicación:", error);
            document.getElementById("mensaje").innerHTML = 
              '<span class="error">❌ Error al crear la publicación</span>';
        });
    });
  </script>
</body>
</html>
